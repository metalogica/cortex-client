"use strict";(()=>{var X=Object.create;var h=Object.defineProperty,z=Object.defineProperties,N=Object.getOwnPropertyDescriptor,O=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,E=Object.getPrototypeOf,b=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var f=(t,e,s)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,p=(t,e)=>{for(var s in e||(e={}))b.call(e,s)&&f(t,s,e[s]);if(k)for(var s of k(e))W.call(e,s)&&f(t,s,e[s]);return t},x=(t,e)=>z(t,O(e));var w=(t,e)=>()=>(t&&(e=t(t=0)),e);var G=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var P=(t,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!b.call(t,n)&&n!==s&&h(t,n,{get:()=>e[n],enumerable:!(o=N(e,n))||o.enumerable});return t};var Q=(t,e,s)=>(s=t!=null?X(E(t)):{},P(e||!t||!t.__esModule?h(s,"default",{value:t,enumerable:!0}):s,t));var d=(t,e,s)=>new Promise((o,n)=>{var l=c=>{try{i(s.next(c))}catch(r){n(r)}},a=c=>{try{i(s.throw(c))}catch(r){n(r)}},i=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,a);i((s=s.apply(t,e)).next())});var u,C,I=w(()=>{"use strict";u=class{constructor(e){this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.cortexToken=void 0,this.sessionId=void 0,this.headset=e.headset,this.callbacks=e.callbacks,this.webSocketClient=e.webSocketClient}send(e){this.webSocketClient.send(JSON.stringify(e))}authorize(e){console.log("CortexHandler: authorize function called",e);let s={id:1,jsonrpc:"2.0",method:"authorize",params:{clientId:this.clientId,clientSecret:this.clientSecret,debit:1}};this.send(s)}parse(e){var i,c,r;let{data:s}=e,o=JSON.parse(s),n=(i=o==null?void 0:o.result)==null?void 0:i.cortexToken;n&&(this.cortexToken=n,this._getSessionId());let l=((c=o==null?void 0:o.result)==null?void 0:c.appId)&&((r=o==null?void 0:o.result)==null?void 0:r.id);l&&(this.sessionId=l,this._getStream());let a=o==null?void 0:o.com;if(a){let[y,H]=a;this._handleCallback({name:y,magnitude:H})}}_handleCallback({name:e,magnitude:s}){let{action:o}=this.callbacks.find(n=>n.name===e);o({name:e,magnitude:s})}_getStream(){let e={id:1,jsonrpc:"2.0",method:"subscribe",params:{cortexToken:this.cortexToken,session:this.sessionId,streams:["com"]}};this.send(e)}_send(s){return d(this,arguments,function*({message:e}){yield this.ws.send(JSON.stringify(e))})}_getCortexToken(){return d(this,null,function*(){let e={id:1,jsonrpc:"2.0",method:"authorize",params:{clientId:this.clientId,clientSecret:this.clientSecret,debit:1}}})}_getSessionId(){return d(this,null,function*(){let e={id:1,jsonrpc:"2.0",method:"createSession",params:{cortexToken:this.cortexToken,headset:this.headset,status:"active"}};this.send(e)})}},C=u});var m,g,T=w(()=>{"use strict";I();m=class extends WebSocket{constructor(s,o){super(s);this.onopen=function(s){console.log("ws: onopen fired: ",s),this.cortexHandler.authorize()};this.onmessage=function(s){let o=this.cortexHandler.parse(s)};this.onclose=function(s){console.log("ws: connection closed: ",s)};this.onerror=function(s){console.error("ws: error: ",s)};this.cortexHandler=new C(x(p({},o),{webSocketClient:this}))}},g=m});var _=G((q,J)=>{"use strict";T();var S=class{constructor(e){this.webSocketClient=g,this.options=e,this.url=e.url}stream(){this.webSocketClient=new this.webSocketClient(this.url,this.options)}stop(){this.webSocketClient.close()}};J.exports=t=>new S(t)});var j=Q(_()),v=(0,j.default)({url:"wss://localhost:6868",headset:"EPOCX-E202014A",clientId:"OagQZeyXwrYoSwQt4JGtGL7HX22U2vJQDnpW6sOK",clientSecret:"WNhMfomUciXSJovRXPYEnPZrHq5ETDvR73FVSxlBMRHXbrfBm6q0z0W6l07oj7BchXcVmWQ6Yvd31ipR6ybn6lfxx8aNJjcnSNrBa0M5PUuuxC9BvEocGCjdJsG41nv2",callbacks:[{name:"neutral",action:({name:t,magnitude:e})=>console.log("CallbackFn: it fired: neutral",t,e+5)},{name:"lift",action:({name:t,magnitude:e})=>console.log("Callback: it fired: lift",t,e)}]});console.log("cortex class: ",v);v.stream();})();
//# sourceMappingURL=index.js.map
