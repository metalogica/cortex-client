"use strict";(()=>{var O=Object.create;var d=Object.defineProperty,y=Object.defineProperties,z=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyDescriptors,E=Object.getOwnPropertyNames,f=Object.getOwnPropertySymbols,N=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var k=(s,e,t)=>e in s?d(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,b=(s,e)=>{for(var t in e||(e={}))m.call(e,t)&&k(s,t,e[t]);if(f)for(var t of f(e))W.call(e,t)&&k(s,t,e[t]);return s},x=(s,e)=>y(s,B(e));var p=(s,e)=>()=>(s&&(e=s(s=0)),e);var G=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports);var P=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of E(e))!m.call(s,n)&&n!==t&&d(s,n,{get:()=>e[n],enumerable:!(o=z(e,n))||o.enumerable});return s};var Q=(s,e,t)=>(t=s!=null?O(N(s)):{},P(e||!s||!s.__esModule?d(t,"default",{value:s,enumerable:!0}):t,s));var w=(s,e,t)=>new Promise((o,n)=>{var l=c=>{try{i(t.next(c))}catch(r){n(r)}},a=c=>{try{i(t.throw(c))}catch(r){n(r)}},i=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,a);i((t=t.apply(s,e)).next())});var h,C,I=p(()=>{"use strict";h=class{constructor(e){this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.cortexToken=void 0,this.sessionId=void 0,this.headset=e.headset,this.callbacks=e.callbacks,this.webSocketClient=e.webSocketClient}send(e){this.webSocketClient.send(JSON.stringify(e))}authorize(e){console.log("CortexHandler: authorize function called",e);let t={id:1,jsonrpc:"2.0",method:"authorize",params:{clientId:this.clientId,clientSecret:this.clientSecret,debit:1}};this.send(t)}parse(e){var i,c,r;let{data:t}=e,o=JSON.parse(t),n=(i=o==null?void 0:o.result)==null?void 0:i.cortexToken;n&&(this.cortexToken=n,this._updateSessionStorage({cortexToken:n}),this._getSessionId());let l=((c=o==null?void 0:o.result)==null?void 0:c.appId)&&((r=o==null?void 0:o.result)==null?void 0:r.id);l&&(this.sessionId=l,this._updateSessionStorage({sessionId:l}),this._getStream());let a=o==null?void 0:o.com;if(a){let[J,X]=a;this._handleCallback({name:J,magnitude:X})}}_handleCallback({name:e,magnitude:t}){let{action:o}=this.callbacks.find(n=>n.name===e);o({name:e,magnitude:t})}_getStream(){let e={id:1,jsonrpc:"2.0",method:"subscribe",params:{cortexToken:this.cortexToken,session:this.sessionId,streams:["com"]}};this.send(e)}_getSessionId(){return w(this,null,function*(){let e={id:1,jsonrpc:"2.0",method:"createSession",params:{cortexToken:this.cortexToken,headset:this.headset,status:"active"}};this.send(e)})}_updateSessionStorage(e){for(let[t,o]of Object.entries(e))localStorage.setItem(t,o)}},C=h});var u,g,T=p(()=>{"use strict";I();u=class extends WebSocket{constructor(t,o){super(t);this.onopen=function(t){console.log("ws: onopen fired: ",t),this.cortexHandler.authorize()};this.onmessage=function(t){let o=this.cortexHandler.parse(t)};this.onclose=function(t){console.log("ws: connection closed: ",t)};this.onerror=function(t){console.error("ws: error: ",t)};this.cortexHandler=new C(x(b({},o),{webSocketClient:this})),this.clientId=o.clientId,this.clientSecret=o.clientSecret,this.cortexToken=void 0,this.sessionId=void 0,this.headset=o.headset}},g=u});var v=G((q,_)=>{"use strict";T();var S=class{constructor(e){this.webSocketClient=g,this.options=e,this.url=e.url}stream(){this.webSocketClient=new this.webSocketClient(this.url,this.options)}stop(){this.webSocketClient.close()}};_.exports=s=>new S(s)});var j=Q(v()),H=(0,j.default)({url:"wss://localhost:6868",headset:"EPOCX-E202014A",clientId:"OagQZeyXwrYoSwQt4JGtGL7HX22U2vJQDnpW6sOK",clientSecret:"WNhMfomUciXSJovRXPYEnPZrHq5ETDvR73FVSxlBMRHXbrfBm6q0z0W6l07oj7BchXcVmWQ6Yvd31ipR6ybn6lfxx8aNJjcnSNrBa0M5PUuuxC9BvEocGCjdJsG41nv2",callbacks:[{name:"neutral",action:({name:s,magnitude:e})=>console.log("CallbackFn: it fired: neutral",s,e+5)},{name:"lift",action:({name:s,magnitude:e})=>console.log("Callback: it fired: lift",s,e)}]});console.log("cortex class: ",H);H.stream();})();
//# sourceMappingURL=index.js.map
