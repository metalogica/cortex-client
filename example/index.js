"use strict";(()=>{var z=Object.create;var d=Object.defineProperty,B=Object.defineProperties,E=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,W=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var S=(t,e,s)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,x=(t,e)=>{for(var s in e||(e={}))m.call(e,s)&&S(t,s,e[s]);if(k)for(var s of k(e))y.call(e,s)&&S(t,s,e[s]);return t},b=(t,e)=>B(t,N(e));var p=(t,e)=>()=>(t&&(e=t(t=0)),e);var G=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var P=(t,e,s,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of O(e))!m.call(t,o)&&o!==s&&d(t,o,{get:()=>e[o],enumerable:!(n=E(e,o))||n.enumerable});return t};var Q=(t,e,s)=>(s=t!=null?z(W(t)):{},P(e||!t||!t.__esModule?d(s,"default",{value:t,enumerable:!0}):s,t));var w=(t,e,s)=>new Promise((n,o)=>{var l=c=>{try{i(s.next(c))}catch(r){o(r)}},a=c=>{try{i(s.throw(c))}catch(r){o(r)}},i=c=>c.done?n(c.value):Promise.resolve(c.value).then(l,a);i((s=s.apply(t,e)).next())});var h,C,I=p(()=>{"use strict";h=class{constructor(e){this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.cortexToken=void 0,this.sessionId=void 0,this.headset=e.headset,this.callbacks=e.callbacks,this.webSocketClient=e.webSocketClient}send(e){this.webSocketClient.send(JSON.stringify(e))}authorize(e){console.log("CortexHandler: authorize function called",e);let s={id:1,jsonrpc:"2.0",method:"authorize",params:{clientId:this.clientId,clientSecret:this.clientSecret,debit:1}};this.send(s)}parse(e){var i,c,r;let{data:s}=e,n=JSON.parse(s),o=(i=n==null?void 0:n.result)==null?void 0:i.cortexToken;o&&(this.cortexToken=o,this._getSessionId());let l=((c=n==null?void 0:n.result)==null?void 0:c.appId)&&((r=n==null?void 0:n.result)==null?void 0:r.id);l&&(this.sessionId=l,this._getStream());let a=n==null?void 0:n.com;if(a){let[j,_]=a;this._handleCallback({name:j,magnitude:_})}}_handleCallback({name:e,magnitude:s}){let{action:n}=this.callbacks.find(o=>o.name===e);n({name:e,magnitude:s})}_getStream(){let e={id:1,jsonrpc:"2.0",method:"subscribe",params:{cortexToken:this.cortexToken,session:this.sessionId,streams:["com"]}};this.send(e)}_getSessionId(){return w(this,null,function*(){let e={id:1,jsonrpc:"2.0",method:"createSession",params:{cortexToken:this.cortexToken,headset:this.headset,status:"active"}};this.send(e)})}},C=h});var u,g,T=p(()=>{"use strict";I();u=class extends WebSocket{constructor(s,n){super(s);this.onopen=function(s){console.log("ws: onopen fired: ",s),this.cortexHandler.authorize()};this.onmessage=function(s){let n=this.cortexHandler.parse(s)};this.onclose=function(s){console.log("ws: connection closed: ",s)};this.onerror=function(s){console.error("ws: error: ",s)};this.cortexHandler=new C(b(x({},n),{webSocketClient:this})),this.clientId=n.clientId,this.clientSecret=n.clientSecret,this.cortexToken=void 0,this.sessionId=void 0,this.headset=n.headset}},g=u});var H=G((q,v)=>{"use strict";T();var f=class{constructor(e){this.webSocketClient=g,this.options=e,this.url=e.url}stream(){this.webSocketClient=new this.webSocketClient(this.url,this.options)}stop(){this.webSocketClient.close()}};v.exports=t=>new f(t)});var J=Q(H()),X=(0,J.default)({url:"wss://localhost:6868",headset:"EPOCX-E202014A",clientId:"OagQZeyXwrYoSwQt4JGtGL7HX22U2vJQDnpW6sOK",clientSecret:"WNhMfomUciXSJovRXPYEnPZrHq5ETDvR73FVSxlBMRHXbrfBm6q0z0W6l07oj7BchXcVmWQ6Yvd31ipR6ybn6lfxx8aNJjcnSNrBa0M5PUuuxC9BvEocGCjdJsG41nv2",callbacks:[{name:"neutral",action:({name:t,magnitude:e})=>console.log("CallbackFn: it fired: neutral",t,e+5)},{name:"lift",action:({name:t,magnitude:e})=>console.log("Callback: it fired: lift",t,e)}]});console.log("cortex class: ",X);X.stream();})();
//# sourceMappingURL=index.js.map
